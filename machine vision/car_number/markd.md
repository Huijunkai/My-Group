# 车牌识别系统技术文档

## 项目概述

本项目是一个基于计算机视觉的车牌识别系统，能够批量处理图片文件并识别其中的车牌信息，包括车牌号码、颜色、类型、所属地区等，并生成结构化的识别结果和统计信息。系统采用HyperLPR作为核心识别引擎，结合图像预处理和后处理技术，提高车牌识别的准确性和鲁棒性。

## 功能特点

- 支持批量处理多种格式的图片文件（JPG、JPEG、PNG、BMP）
- 识别车牌号码并进行格式校验和修正
- 分析车牌颜色（蓝色、黄色、绿色、白色、红色、黑色等）
- 判定车牌类型（小型客车、大型客车、新能源车辆、警用/军用车辆等）
- 识别车牌所属地区
- 生成详细的识别结果表格和统计信息（识别成功率、颜色分布、类型分布）

## 环境依赖

- Python 3.x
- OpenCV (cv2)
- NumPy
- HyperLPR（车牌识别引擎）

## 安装说明

1. 安装依赖库：
```bash
pip install opencv-python numpy hyperlpr
```

2. 克隆或下载项目代码到本地目录

## 使用方法

### 基本使用

1. 将需要识别的图片文件放入项目的`data_jpg`目录（默认目录）
2. 运行主程序：
```bash
python main.py
```

### 指定图片目录

如需处理其他目录下的图片，可通过命令行参数指定目标文件夹：
```bash
python main.py /path/to/your/image/folder
```

### 输出说明

程序运行后将输出：
- 识别结果表格：包含图片名称、识别结果、颜色、类型、所属地区和状态
- 统计结果：总图片数、识别成功率
- 颜色分布：各颜色车牌的数量和占比
- 车辆类型分布：各类型车辆的数量和占比

## 代码结构

### 主要文件

1. `main.py`：主程序入口，负责命令行参数处理、结果格式化输出和统计分析
2. `plate_recognition.py`：核心识别模块，包含图像预处理、车牌检测与识别等功能
3. `plate_mappings.py`：映射表定义，包括省份简称映射和特殊车牌类型映射

### 核心模块详解

#### 1. 主程序模块（main.py）

主要功能：
- 解析命令行参数，确定目标图片文件夹
- 调用批量处理函数获取识别结果
- 格式化输出识别结果表格
- 计算并展示统计信息

关键函数：
- `disp_len(s)`：计算字符串显示宽度（中文计为2，其他字符计为1）
- `truncate_display(s, w)`：按显示宽度截断字符串
- `fmt_fixed(s, w)`：格式化字符串为固定显示宽度
- 统计分析相关函数：计算识别成功率、颜色分布和类型分布

#### 2. 车牌识别模块（plate_recognition.py）

主要功能：
- 图像预处理与增强
- 多尺度车牌检测
- 车牌号码识别与修正
- 车牌颜色分析
- 车牌类型判断
- 批量处理图片

关键函数：

1. **图像处理函数**：
   - `enhance_image_for_plate(image)`：针对车牌颜色区域进行图像增强
   - `preprocess_for_recognition(image)`：使用CLAHE和锐化进行预处理

2. **车牌识别函数**：
   - `recognize_plate(image_path)`：单张图片车牌识别主函数
   - `batch_process(folder_path)`：批量处理文件夹中的图片
   - `_detect_plates_hyperlpr(img_name, image, scales)`：多尺度车牌检测

3. **后处理函数**：
   - `postprocess_plate(plate_str)`：车牌字符串后处理（去除无效字符）
   - `correct_plate_string(plate_str)`：修正常见OCR误识别（如O→0，I→1）

4. **特征分析函数**：
   - `get_plate_color(image, plate_region)`：基于HSV颜色空间分析车牌颜色
   - `is_split_yellow_green_plate(image, plate_region)`：判断是否为新能源大型车牌
   - `check_plate_number_format(plate_str, plate_color)`：检查车牌格式有效性

#### 3. 映射表模块（plate_mappings.py）

定义了两个核心映射表：
- `PROVINCE_MAP`：省份简称到完整省份名称的映射（如'京'→'北京市'）
- `SPECIAL_PLATE_TYPES`：特殊车牌字符到车辆类型的映射（如'警'→'警用车辆'）

## 识别流程

1. **图像预处理**：
   - 颜色空间转换（BGR→HSV）
   - 对比度增强（CLAHE）
   - 锐化处理

2. **车牌检测**：
   - 多尺度检测（1.0, 0.8, 1.2缩放比例）
   - 基于HyperLPR引擎的车牌定位

3. **车牌识别**：
   - 车牌号码提取
   - 后处理与错误修正
   - 格式校验

4. **特征分析**：
   - 车牌颜色识别
   - 车牌类型判断
   - 所属地区判定

5. **结果整理**：
   - 生成结构化结果
   - 统计分析
   - 格式化输出

## 配置说明

- `DEBUG`：调试开关（位于plate_recognition.py），设置为`True`时输出调试信息
- 颜色阈值：在`get_plate_color`函数中定义，可根据实际需求调整
- 多尺度检测比例：在`_detect_plates_hyperlpr`函数中定义，可添加或修改检测尺度

## 常见问题

1. **未识别到车牌**：
   - 检查图片质量，确保车牌清晰可见
   - 确认车牌在图片中占据一定比例
   - 复杂背景可能影响识别效果，可尝试预处理图片

2. **识别错误**：
   - 车牌模糊或有遮挡可能导致识别错误
   - 特殊字体或不标准车牌可能识别不准确
   - 可尝试调整图像增强参数提高识别率

3. **文件读取错误**：
   - 检查文件路径是否正确
   - 确认图片文件未损坏
   - 确保程序有访问文件的权限

## 扩展建议

1. 增加对视频流的实时识别支持
2. 优化小尺寸或低清晰度车牌的识别算法
3. 添加车牌信息数据库查询功能
4. 增加图形化用户界面（GUI）
5. 支持更多车牌类型和特殊车牌的识别